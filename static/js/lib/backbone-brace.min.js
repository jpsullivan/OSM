/*!
*  Backbone Brace - 2014-06-27
*  Copyright 2014 Atlassian Software Systems Pty Ltd
*  Licensed under the Apache License, Version 2.0
*/
!function(a,b){var c="Brace",d=a[c],e=function(){return a[c]=d,this};if("function"==typeof define&&define.amd)define(["underscore","backbone"],b);else if("object"==typeof exports)module.exports=b(require("underscore"),require("backbone"));else{var f=b(a._,a.Backbone);f.noConflict=e,a[c]=f}}(this,function(a,b){function c(b){return a.isArray(b)?a.reduce(b,function(a,b){return a[b]=null,a},{}):b}function d(b,c){if(!b||null==c)return c;if(b===String&&a.isString(c))return c;if(b===Number&&a.isNumber(c))return c;if(b===Boolean&&a.isBoolean(c))return c;if("string"==typeof b||b instanceof String){if(typeof c!=""+b)throw"The typeof "+c+" is "+typeof c+" but expected it to be "+b;return c}if(a.isArray(b)||b===Array){if(!f(c))throw"Array type expected, but nonnull, non-Array value provided.";return b!==Array&&b[0]?a.map(c,a.bind(d,null,b[0])):c}if("function"!=typeof b)throw"Invalid expected type "+b+". Should be falsy, String, Array, Backbone.Collection constructor, or function.";return c instanceof b?c:new b(e(b)?d([b.model],c):c)}function e(a,c){return a&&(a.__super__ instanceof(c||b.Collection)||a.__super__===(c||b.Collection).prototype||a===(c||b.Collection))}function f(c){return a.has(c,"length")&&!(c instanceof String||a.has({string:1,"function":1},typeof c)||c instanceof b.Collection)}function g(b,c){var d={};return a.each(b,function(a,b){if(c[b]&&!h(a,c[b])){if(!a||h(c[b],a))return;throw b+" has conflicted type descriptors."}d[b]=a}),d}function h(a,b){return b&&b!==a?a&&"string"!=typeof a?a instanceof Array?b===Array||b instanceof Array&&h(a[0],b[0]):"function"!=typeof b?!1:e(b)?e(a,b):a.prototype instanceof b:!1:!0}function i(b){return a.isObject(b)?a.reduce(b,function(b,c,d){return c&&a.isFunction(c.toJSON)?b[d]=c.toJSON():a.isArray(c)&&(b[d]=a.map(c,function(b){return b&&a.isFunction(b.toJSON)?b.toJSON():b})),b},b):b}function j(a){return function(){var b=a.call(this);return i(b)}}function k(b){return function d(e,f){var g,h,i=a.extend({},e);return e&&e.mixins&&(h=e.mixins,delete i.mixins),g=b.call(this,i,f),this.prototype.namedEvents&&p.Mixins.applyMixin(g,{namedEvents:this.prototype.namedEvents}),this.prototype.namedAttributes&&p.Mixins.applyMixin(g,{namedAttributes:this.prototype.namedAttributes}),h&&a.each(e.mixins,function(a){p.Mixins.applyMixin(g,a)}),g.prototype.namedEvents&&p.Mixins.applyMixin(g,p.EventsMixinCreator.create(g.prototype.namedEvents)),g.prototype.namedAttributes&&(g.prototype.namedAttributes=c(g.prototype.namedAttributes),p.Mixins.applyMixin(g,p.AttributesMixinCreator.create(g.prototype.namedAttributes,g.prototype.idAttribute))),g.prototype.toJSON&&(g.prototype.toJSON=j(g.prototype.toJSON)),g.extend=d,g}}function l(b,c){var e=b.prototype,f=c.prototype,g=e.set;f.set=function(b,c,e){var f,h=this.namedAttributes;if(!h||null==b)return g.apply(this,arguments);a.isObject(b)?(f=a.clone(b),e=c):(f={},f[b]=c);for(var i in f)if(a.has(f,i)){if(!a.has(h,i))throw"Attribute '"+i+"' does not exist";f[i]=d(h[i],f[i])}return g.call(this,f,e)};var h=e.get;f.get=function(b){if(this.namedAttributes&&!a.has(this.namedAttributes,b))throw"Attribute '"+b+"' does not exist";return h.apply(this,arguments)}}function m(b,c){var d=b.prototype,e=c.prototype,f=d.parse;e.parse=function(b,c){return a.pick(f(b,c),a.keys(this.namedAttributes))}}function n(a){var b=a.extend(),c=a.extend;return b.extend=k(c),b}function o(a){var b=n(a);return l(a,b),m(a,b),b}var p={};p.Mixins={createMethodName:function(a,b){return a+b.charAt(0).toUpperCase()+b.substr(1)},applyMixin:function(b,d){a.forEach(a.keys(d),function(e){var f=b.prototype;if("initialize"===e){var h=f.initialize;return void(f.initialize=function(){h&&h.apply(this,arguments),d.initialize.apply(this,arguments)})}if("validate"===e){var i=f.validate;return void(f.validate=function(){if(i){var a=i.apply(this,arguments);if(a)return a}return d.validate.apply(this,arguments)})}if("defaults"!==e){if("namedAttributes"===e){var j=c(f.namedAttributes)||{},k=c(d[e]);return void(f.namedAttributes=a.extend(j,g(k,j)))}if("namedEvents"===e){if(!a.isArray(d[e]))throw"Expects events member on mixin to be an array";return f.namedEvents||(f.namedEvents=[]),void(f.namedEvents=a.uniq(f.namedEvents.concat(d[e])))}if(f.hasOwnProperty(e))throw"Mixin error: class already has property '"+e+"' defined";f[e]=d[e]}else{var l=f.defaults||(f.defaults={}),m=d[e];for(var n in m){if(l.hasOwnProperty(n))throw"Mixin error: class already has default '"+n+"' defined";l[n]=m[n]}}},this)}},p.AttributesMixinCreator={create:function(b,c){var d={};if(b||(b={}),a.has(b,"id")||(b.id=null),a.each(b,function(a,b){var c=p.Mixins.createMethodName("set",b);d[c]=function(a,c){return this.set(b,a,c)};var e=p.Mixins.createMethodName("get",b);d[e]=function(){return this.get(b)}}),"string"==typeof c&&"undefined"!=typeof b[c]&&"id"!==c){b.id=b[c];var e=p.Mixins.createMethodName("get",c),f=p.Mixins.createMethodName("set",c);d.getId=function(){return this[e]()},d.setId=function(a,b){return this[f](a,b)}}return d},ensureType:d},p.EventsMixinCreator={create:function(b){var c={},d=function(b){var d=p.Mixins.createMethodName("on",b);c[d]=function(){return this.on.apply(this,[b].concat(a.toArray(arguments)))};var e=p.Mixins.createMethodName("trigger",b);c[e]=function(){return this.trigger.apply(this,[b].concat(a.toArray(arguments)))}};return a.each(b,a.bind(d,this)),c}},p.Model=o(b.Model),p.Collection=n(b.Collection),p.View=n(b.View),p.Router=n(b.Router);var q=function(){this.initialize.apply(this,arguments)};return a.extend(q.prototype,b.Events,{initialize:function(){}}),q.extend=b.Model.extend,p.Evented=n(q),p});
